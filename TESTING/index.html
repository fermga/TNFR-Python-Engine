<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>TNFR Testing Guide — TNFR Python Engine</title>
  <meta name="description" content="TNFR documentation: TNFR Testing Guide">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap"
    >
  <style>
    :root {
      color-scheme: dark;
      --bg: #0e0f11;
      --panel: rgba(24, 25, 27, 0.9);
      --border: rgba(90, 92, 95, 0.4);
      --text: #e4e6eb;
      --muted: #9ea4b3;
      --accent: #6aa0ff;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      line-height: 1.6;
      background: radial-gradient(circle at 20% 20%, #1a1c20, var(--bg));
      color: var(--text);
      min-height: 100vh;
      padding: 2rem;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
        .page {
            max-width: 960px;
            margin: 0 auto;
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 2.5rem 3rem 3rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        }
        header {
            border-bottom: 1px solid var(--border);
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }
    .home-link { font-weight: 600; color: var(--text); }
        .doc-title {
            display: block;
            font-size: 2.2rem;
            font-weight: 600;
            margin-top: 0.4rem;
        }
        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-top: 1rem;
            font-size: 0.95rem;
            color: var(--muted);
        }
    main { font-size: 1rem; }
    main h1 { font-size: 2rem; margin-top: 2.5rem; }
        main h2 {
            font-size: 1.5rem;
            margin-top: 2rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.3rem;
        }
    main h3 { font-size: 1.2rem; margin-top: 1.5rem; }
    main p { margin: 1rem 0; }
        pre {
            background: #0a0b0d;
            padding: 1rem;
            border-radius: 10px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
    code { font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; }
    table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; }
        th, td {
            border: 1px solid var(--border);
            padding: 0.6rem 0.8rem;
            text-align: left;
        }
        blockquote {
            border-left: 4px solid var(--accent);
            margin: 1.5rem 0;
            padding: 0.2rem 1rem;
            color: var(--muted);
            background: rgba(255, 255, 255, 0.02);
        }
        footer {
            border-top: 1px solid var(--border);
            margin-top: 2.5rem;
            padding-top: 1.5rem;
            font-size: 0.9rem;
            color: var(--muted);
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: space-between;
        }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <a class="home-link" href="/TNFR-Python-Engine/">TNFR Python Engine</a>
      <span class="doc-title">TNFR Testing Guide</span>
      <div class="meta">
        <span>Version 0.0.2 · DOI <a href="https://doi.org/10.5281/zenodo.17764207" target="_blank" rel="noopener">10.5281/zenodo.17764207</a> · Updated 2025-11-29</span>
                <span>
                    Source
                    <a
                        href="https://github.com/fermga/TNFR-Python-Engine/blob/main/TESTING.md"
                        target="_blank"
                        rel="noopener"
                    >
                        TESTING.md
                    </a>
                </span>
      </div>
    </header>
    <main>
      <h1 id="tnfr-testing-guide">TNFR Testing Guide</h1>
<p>This document describes the testing strategy, infrastructure, and best practices for the TNFR Python Engine. It consolidates information about test organization, coverage requirements, and structural fidelity validation.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#testing-philosophy">Testing Philosophy</a></li>
<li><a href="#test-organization">Test Organization</a></li>
<li><a href="#running-tests">Running Tests</a></li>
<li><a href="#test-categories">Test Categories</a></li>
<li><a href="#structural-fidelity-tests">Structural Fidelity Tests</a></li>
<li><a href="#backend-selection">Backend Selection</a></li>
<li><a href="#coverage-requirements">Coverage Requirements</a></li>
<li><a href="#test-development-guidelines">Test Development Guidelines</a></li>
</ul>
<h2 id="testing-philosophy">Testing Philosophy</h2>
<p>TNFR tests validate <strong>structural coherence</strong> first, implementation details second. Every test must:</p>
<ol>
<li><strong>Preserve TNFR Invariants</strong>: Verify canonical constraints (see ARCHITECTURE.md §3)</li>
<li><strong>Test Structural Behavior</strong>: Focus on coherence, phase, frequency, not implementation</li>
<li><strong>Maintain Reproducibility</strong>: Use seeds, validate determinism</li>
<li><strong>Guard Regressions</strong>: Performance, accuracy, and API stability</li>
</ol>
<p>Tests are <strong>not</strong> responsible for:
- Fixing unrelated pre-existing failures
- Optimizing code that already passes
- Validating framework internals (NetworkX, NumPy)</p>
<h2 id="test-organization">Test Organization</h2>
<p>The test suite is organized by concern and scope:</p>
<div class="codehilite"><pre><span></span><code><span class="n">tests</span><span class="o">/</span>
<span class="err">├──</span><span class="w"> </span><span class="n">conftest</span><span class="o">.</span><span class="n">py</span><span class="w">              </span><span class="c1"># Shared fixtures and configuration</span>
<span class="err">├──</span><span class="w"> </span><span class="n">utils</span><span class="o">.</span><span class="n">py</span><span class="w">                 </span><span class="c1"># Test utilities (module clearing, etc.)</span>
<span class="err">├──</span><span class="w"> </span><span class="n">unit</span><span class="o">/</span><span class="w">                    </span><span class="c1"># Unit tests for individual modules</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">test_cache</span><span class="o">.</span><span class="n">py</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">test_dynamics</span><span class="o">.</span><span class="n">py</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">test_operators</span><span class="o">.</span><span class="n">py</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">test_structural</span><span class="o">.</span><span class="n">py</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="o">...</span>
<span class="err">├──</span><span class="w"> </span><span class="n">integration</span><span class="o">/</span><span class="w">             </span><span class="c1"># Integration tests for subsystems</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">test_glyph_sequences</span><span class="o">.</span><span class="n">py</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">test_operator_chains</span><span class="o">.</span><span class="n">py</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">test_telemetry_pipeline</span><span class="o">.</span><span class="n">py</span>
<span class="err">├──</span><span class="w"> </span><span class="n">property</span><span class="o">/</span><span class="w">                </span><span class="c1"># Property-based tests (Hypothesis)</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">test_tnfr_invariants</span><span class="o">.</span><span class="n">py</span>
<span class="err">├──</span><span class="w"> </span><span class="n">stress</span><span class="o">/</span><span class="w">                  </span><span class="c1"># Stress and scale tests</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">test_large_networks</span><span class="o">.</span><span class="n">py</span>
<span class="err">├──</span><span class="w"> </span><span class="n">performance</span><span class="o">/</span><span class="w">             </span><span class="c1"># Performance regression tests</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">test_dnfr_pipeline</span><span class="o">.</span><span class="n">py</span>
<span class="err">├──</span><span class="w"> </span><span class="n">mathematics</span><span class="o">/</span><span class="w">             </span><span class="c1"># Mathematical backend tests</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">test_epi</span><span class="o">.</span><span class="n">py</span>
<span class="err">└──</span><span class="w"> </span><span class="n">cli</span><span class="o">/</span><span class="w">                     </span><span class="c1"># CLI interface tests</span>
<span class="w">    </span><span class="err">└──</span><span class="w"> </span><span class="n">test_cli</span><span class="o">.</span><span class="n">py</span>
</code></pre></div>

<h3 id="key-test-files">Key Test Files</h3>
<table>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
<th>Markers</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>test_extreme_cases.py</code></td>
<td>Boundary value testing</td>
<td><code>unit</code></td>
</tr>
<tr>
<td><code>test_glyph_sequences.py</code></td>
<td>Grammar and sequence validation</td>
<td><code>integration</code></td>
</tr>
<tr>
<td><code>test_tnfr_invariants.py</code></td>
<td>Property-based invariant checks</td>
<td><code>property</code>, <code>slow</code></td>
</tr>
<tr>
<td><code>test_dnfr_pipeline.py</code></td>
<td>Performance regression guards</td>
<td><code>performance</code>, <code>slow</code></td>
</tr>
<tr>
<td><code>test_trace.py</code></td>
<td>Telemetry and debugging utilities</td>
<td><code>unit</code></td>
</tr>
</tbody>
</table>
<h2 id="running-tests">Running Tests</h2>
<h3 id="basic-test-execution">Basic Test Execution</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run all tests (excluding slow/benchmarks by default)</span>
pytest

<span class="c1"># Run specific test category</span>
pytest<span class="w"> </span>tests/unit
pytest<span class="w"> </span>tests/integration

<span class="c1"># Run with coverage report</span>
pytest<span class="w"> </span>--cov<span class="o">=</span>tnfr<span class="w"> </span>--cov-report<span class="o">=</span>html

<span class="c1"># Run verbose with output</span>
pytest<span class="w"> </span>-v<span class="w"> </span>-s
</code></pre></div>

<h3 id="artifact-guards">Artifact Guards</h3>
<p>Telemetry dashboards are part of the reproducibility surface. A lightweight regression test (<code>tests/test_precision_walk_dashboard_artifact.py</code>) ensures <code>benchmarks/results/precision_walk_dashboard.json</code> is valid JSON (no <code>NaN</code> literals) and remains loadable by downstream tooling. It now runs automatically via:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Curated smoke bundle (includes dashboard JSON guard)</span>
make<span class="w"> </span>smoke-tests

<span class="c1"># Run the guard directly when iterating on telemetry scripts</span>
pytest<span class="w"> </span>tests/test_precision_walk_dashboard_artifact.py
</code></pre></div>

<h3 id="test-markers">Test Markers</h3>
<p>Tests are marked for selective execution:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run only fast tests (default in CI)</span>
pytest<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;not slow&quot;</span>

<span class="c1"># Run slow/property-based tests</span>
pytest<span class="w"> </span>-m<span class="w"> </span>slow

<span class="c1"># Run performance regression tests</span>
pytest<span class="w"> </span>-m<span class="w"> </span>performance<span class="w"> </span>tests/performance

<span class="c1"># Run backend-specific tests</span>
pytest<span class="w"> </span>-m<span class="w"> </span>numpy_only
pytest<span class="w"> </span>-m<span class="w"> </span>requires_jax
</code></pre></div>

<h3 id="configuration">Configuration</h3>
<p>Default pytest options are configured in <code>pyproject.toml</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">[tool.pytest.ini_options]</span>
<span class="n">testpaths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tests&quot;</span><span class="p">]</span>
<span class="n">python_files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;test_*.py&quot;</span><span class="p">]</span>
<span class="n">python_classes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Test*&quot;</span><span class="p">]</span>
<span class="n">python_functions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;test_*&quot;</span><span class="p">]</span>
<span class="n">addopts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;-m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;not slow&quot;</span><span class="p">,</span><span class="w">          </span><span class="c1"># Skip slow tests by default</span>
<span class="w">    </span><span class="s2">&quot;--benchmark-skip&quot;</span><span class="p">,</span><span class="w">        </span><span class="c1"># Skip benchmarks by default</span>
<span class="w">    </span><span class="s2">&quot;--strict-markers&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;--tb=short&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">markers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;slow: marks tests as slow (deselected by default)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;performance: marks performance regression tests&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;numpy_only: requires NumPy backend&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;requires_jax: requires JAX backend&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;requires_torch: requires PyTorch backend&quot;</span><span class="p">,</span>
<span class="p">]</span>
</code></pre></div>

<h2 id="test-categories">Test Categories</h2>
<h3 id="1-unit-tests-testsunit">1. Unit Tests (<code>tests/unit/</code>)</h3>
<p><strong>Purpose</strong>: Test individual modules and functions in isolation.</p>
<p><strong>Coverage Areas</strong>:</p>
<ul>
<li>Structural operators (emission, reception, coherence, etc.)</li>
<li>Dynamics (ΔNFR computation, nodal equation integration)</li>
<li>Cache layers (Shelve, Redis, Memory)</li>
<li>Validation (sequence grammar, graph state)</li>
<li>Telemetry (coherence, sense index, traces)</li>
</ul>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_coherence_operator_stabilizes_epi</span><span class="p">(</span><span class="n">simple_graph</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Coherence operator should increase stability.&quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">simple_graph</span>
    <span class="n">initial_coherence</span> <span class="o">=</span> <span class="n">compute_coherence</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

    <span class="n">apply_operator</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="s2">&quot;coherence&quot;</span><span class="p">)</span>

    <span class="n">final_coherence</span> <span class="o">=</span> <span class="n">compute_coherence</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">final_coherence</span> <span class="o">&gt;=</span> <span class="n">initial_coherence</span>
</code></pre></div>

<h3 id="2-integration-tests-testsintegration">2. Integration Tests (<code>tests/integration/</code>)</h3>
<p><strong>Purpose</strong>: Test interactions between subsystems and operator sequences.</p>
<p><strong>Coverage Areas</strong>:</p>
<ul>
<li>Canonical glyph sequences (emission→reception→coherence)</li>
<li>Operator chaining and graph state evolution</li>
<li>Telemetry pipeline end-to-end</li>
<li>Validation and execution coordination</li>
</ul>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_canonical_sequence_execution</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test canonical TNFR sequence executes without errors.&quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">create_nfr</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">epi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">sequence</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;emission&quot;</span><span class="p">,</span> <span class="s2">&quot;reception&quot;</span><span class="p">,</span> <span class="s2">&quot;coherence&quot;</span><span class="p">,</span> <span class="s2">&quot;coupling&quot;</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">run_sequence</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">sequence</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">compute_coherence</span><span class="p">(</span><span class="n">G</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>

<h3 id="3-property-based-tests-testsproperty">3. Property-Based Tests (<code>tests/property/</code>)</h3>
<p><strong>Purpose</strong>: Use Hypothesis to generate test cases validating TNFR invariants.</p>
<p><strong>Coverage Areas</strong>:</p>
<ul>
<li>Operator invariants (bounds preservation, no NaN/inf)</li>
<li>Coherence monotonicity</li>
<li>Phase coupling symmetry</li>
<li>Frequency scaling laws</li>
</ul>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@given</span><span class="p">(</span>
    <span class="n">epi</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">10.0</span><span class="p">),</span>
    <span class="n">vf</span><span class="o">=</span><span class="n">st</span><span class="o">.</span><span class="n">floats</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mf">10.0</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_coherence_operator_preserves_bounds</span><span class="p">(</span><span class="n">epi</span><span class="p">,</span> <span class="n">vf</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Coherence operator should never produce NaN or infinite values.&quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">create_nfr</span><span class="p">(</span><span class="s2">&quot;prop_test&quot;</span><span class="p">,</span> <span class="n">epi</span><span class="o">=</span><span class="n">epi</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="n">vf</span><span class="p">)</span>

    <span class="n">apply_operator</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="s2">&quot;coherence&quot;</span><span class="p">)</span>

    <span class="n">epi_after</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;epi&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">epi_after</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</code></pre></div>

<h3 id="4-stress-tests-testsstress">4. Stress Tests (<code>tests/stress/</code>)</h3>
<p><strong>Purpose</strong>: Validate behavior under extreme conditions and large scales.</p>
<p><strong>Coverage Areas</strong>:</p>
<ul>
<li>Large networks (1000+ nodes)</li>
<li>Long sequences (100+ operators)</li>
<li>Memory usage patterns</li>
<li>Parallel execution stability</li>
</ul>
<p><strong>Example</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">slow</span>
<span class="k">def</span> <span class="nf">test_large_network_coherence</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test coherence computation on large networks.&quot;&quot;&quot;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">epi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">vf</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="n">coherence</span> <span class="o">=</span> <span class="n">compute_coherence</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

    <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">coherence</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">coherence</span><span class="p">)</span>
</code></pre></div>

<h3 id="5-performance-tests-testsperformance">5. Performance Tests (<code>tests/performance/</code>)</h3>
<p><strong>Purpose</strong>: Guard against performance regressions in critical paths.</p>
<p><strong>Coverage Areas</strong>:</p>
<ul>
<li>ΔNFR computation pipeline</li>
<li>Alias cache effectiveness</li>
<li>Trigonometric metric calculations</li>
<li>Sense index computation</li>
</ul>
<p><strong>Execution</strong>:</p>
<div class="codehilite"><pre><span></span><code>pytest<span class="w"> </span>-m<span class="w"> </span>performance<span class="w"> </span>tests/performance
</code></pre></div>

<h2 id="structural-fidelity-tests">Structural Fidelity Tests</h2>
<h2 id="invariant-tests">Invariant Tests</h2>
<p>These tests validate the 6 TNFR canonical invariants. For complete invariant definitions and physics, see <strong><a href="/TNFR-Python-Engine/AGENTS/#canonical-invariants">AGENTS.md § Canonical Invariants</a></strong>.</p>
<h3 id="invariant-1-nodal-equation-integrity">Invariant 1: Nodal Equation Integrity</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_nodal_equation_integrity</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;EPI evolution must follow ∂EPI/∂t = νf · ΔNFR(t) only.&quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">create_nfr</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">epi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">initial_epi</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;epi&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Changes occur only via structural operators</span>
    <span class="c1"># Validates nodal equation constraint</span>
    <span class="n">apply_operator</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="s2">&quot;coherence&quot;</span><span class="p">)</span>

    <span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;epi&quot;</span><span class="p">],</span> <span class="n">initial_epi</span><span class="p">)</span>
</code></pre></div>

<h3 id="invariant-5-structural-metrology">Invariant 5: Structural Metrology</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_structural_metrology_units</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Structural frequency must remain in Hz_str units with proper telemetry.&quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">create_nfr</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">epi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>

    <span class="n">apply_operator</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="s2">&quot;mutation&quot;</span><span class="p">)</span>

    <span class="n">vf</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">&quot;vf&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vf</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">vf</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># Positive Hz_str</span>
</code></pre></div>

<h3 id="invariant-5-phase-check-before-coupling">Invariant 5: Phase Check Before Coupling</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_coupling_requires_phase_check</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Coupling should verify phase synchrony.&quot;&quot;&quot;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
    <span class="n">n1</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">epi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">n2</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">epi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="c1"># Should validate phase compatibility</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
        <span class="n">apply_operator</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="s2">&quot;coupling&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">n2</span><span class="p">)</span>
</code></pre></div>

<h3 id="invariant-8-reproducible-simulations">Invariant 8: Reproducible Simulations</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_deterministic_with_seed</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Same seed should produce same results.&quot;&quot;&quot;</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>

    <span class="c1"># Run 1</span>
    <span class="n">G1</span><span class="p">,</span> <span class="n">node1</span> <span class="o">=</span> <span class="n">create_nfr</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">epi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">run_sequence</span><span class="p">(</span><span class="n">G1</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;emission&quot;</span><span class="p">,</span> <span class="s2">&quot;coherence&quot;</span><span class="p">])</span>
    <span class="n">result1</span> <span class="o">=</span> <span class="n">compute_coherence</span><span class="p">(</span><span class="n">G1</span><span class="p">)</span>

    <span class="c1"># Run 2</span>
    <span class="n">G2</span><span class="p">,</span> <span class="n">node2</span> <span class="o">=</span> <span class="n">create_nfr</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">epi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">run_sequence</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;emission&quot;</span><span class="p">,</span> <span class="s2">&quot;coherence&quot;</span><span class="p">])</span>
    <span class="n">result2</span> <span class="o">=</span> <span class="n">compute_coherence</span><span class="p">(</span><span class="n">G2</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">result1</span> <span class="o">==</span> <span class="n">result2</span>
</code></pre></div>

<h2 id="backend-selection">Backend Selection</h2>
<p>TNFR supports multiple mathematical backends (NumPy, JAX, PyTorch). Tests can specify backend requirements:</p>
<h3 id="environment-variable">Environment Variable</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Set backend before running tests</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">TNFR_MATH_BACKEND</span><span class="o">=</span>numpy<span class="w">  </span><span class="c1"># or jax, torch</span>
pytest<span class="w"> </span>tests/mathematics
</code></pre></div>

<h3 id="command-line">Command Line</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Use pytest option</span>
pytest<span class="w"> </span>tests/mathematics<span class="w"> </span>--math-backend<span class="o">=</span>torch
</code></pre></div>

<h3 id="in-tests">In Tests</h3>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">requires_jax</span>
<span class="k">def</span> <span class="nf">test_jax_specific_feature</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This test requires JAX backend.&quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">tnfr.mathematics</span> <span class="kn">import</span> <span class="n">get_backend</span>
    <span class="n">backend</span> <span class="o">=</span> <span class="n">get_backend</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">backend</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;jax&quot;</span>
</code></pre></div>

<h3 id="backend-availability">Backend Availability</h3>
<p>When a requested backend is unavailable, pytest automatically skips backend-specific tests while continuing with NumPy fallback.</p>
<h2 id="coverage-requirements">Coverage Requirements</h2>
<h3 id="minimum-coverage-targets">Minimum Coverage Targets</h3>
<ul>
<li><strong>Overall</strong>: 80% line coverage</li>
<li><strong>Core modules</strong> (structural, dynamics, operators): 90%</li>
<li><strong>Telemetry</strong> (metrics, trace): 85%</li>
<li><strong>Utilities</strong> (cache, validation): 80%</li>
</ul>
<h3 id="critical-paths-must-be-100-covered">Critical Paths (Must be 100% covered)</h3>
<ul>
<li>Nodal equation integration (<code>dynamics/integrators.py</code>)</li>
<li>Operator registry and dispatch (<code>operators/registry.py</code>)</li>
<li>Canonical sequence validation (<code>validation/__init__.py</code>)</li>
<li>ΔNFR computation (<code>dynamics/dnfr.py</code>)</li>
</ul>
<h3 id="coverage-report">Coverage Report</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Generate HTML coverage report</span>
pytest<span class="w"> </span>--cov<span class="o">=</span>tnfr<span class="w"> </span>--cov-report<span class="o">=</span>html

<span class="c1"># Open report</span>
open<span class="w"> </span>htmlcov/index.html
</code></pre></div>

<h2 id="test-development-guidelines">Test Development Guidelines</h2>
<h3 id="1-test-isolation">1. Test Isolation</h3>
<p>Use <code>clear_test_module()</code> utility for test independence:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">tests.utils</span> <span class="kn">import</span> <span class="n">clear_test_module</span>

<span class="k">def</span> <span class="nf">test_fresh_import</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test with fresh module state.&quot;&quot;&quot;</span>
    <span class="n">clear_test_module</span><span class="p">(</span><span class="s1">&#39;tnfr.utils.io&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">tnfr.utils.io</span>  <span class="c1"># Fresh import</span>
</code></pre></div>

<p><strong>Note</strong>: Module path checking (<code>'module' in sys.modules</code>) may trigger CodeQL warnings. This is legitimate test infrastructure, not URL validation. See ARCHITECTURE.md §"Test isolation and module management".</p>
<h3 id="2-fixture-usage">2. Fixture Usage</h3>
<p>Prefer pytest fixtures for common setup:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">simple_graph</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a simple test graph.&quot;&quot;&quot;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">epi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]),</span> <span class="n">vf</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">node</span>

<span class="k">def</span> <span class="nf">test_with_fixture</span><span class="p">(</span><span class="n">simple_graph</span><span class="p">):</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">simple_graph</span>
    <span class="c1"># Test implementation</span>
</code></pre></div>

<h3 id="3-parametrize-for-variants">3. Parametrize for Variants</h3>
<p>Use <code>pytest.mark.parametrize</code> for multiple test cases:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;operator&quot;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s2">&quot;emission&quot;</span><span class="p">,</span> <span class="s2">&quot;reception&quot;</span><span class="p">,</span> <span class="s2">&quot;coherence&quot;</span><span class="p">,</span> <span class="s2">&quot;dissonance&quot;</span>
<span class="p">])</span>
<span class="k">def</span> <span class="nf">test_operator_preserves_structure</span><span class="p">(</span><span class="n">operator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;All operators should preserve graph structure.&quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">node</span> <span class="o">=</span> <span class="n">create_nfr</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">epi</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">vf</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">apply_operator</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">operator</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span>
</code></pre></div>

<h3 id="4-document-test-intent">4. Document Test Intent</h3>
<p>Every test should have a clear docstring explaining:</p>
<ul>
<li>What structural behavior is being validated</li>
<li>Which TNFR invariant(s) are checked</li>
<li>Why the test matters for coherence</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">test_resonance_propagates_coherence</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resonance operator should propagate coherence to coupled nodes</span>
<span class="sd">    without altering EPI identity (Invariant 1, 4).</span>

<span class="sd">    This test validates that resonance maintains operational</span>
<span class="sd">    fractality while increasing network coupling.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Test implementation</span>
</code></pre></div>

<h3 id="5-avoid-brittleness">5. Avoid Brittleness</h3>
<ul>
<li>Don't assert exact floating-point equality (use <code>np.allclose</code>)</li>
<li>Don't depend on internal implementation details</li>
<li>Don't test framework internals (NetworkX, NumPy)</li>
<li>Focus on structural semantics, not code paths</li>
</ul>
<h3 id="6-performance-awareness">6. Performance Awareness</h3>
<p>Mark slow tests appropriately:</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">slow</span>
<span class="k">def</span> <span class="nf">test_expensive_computation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This test takes &gt;1 second to run.&quot;&quot;&quot;</span>
    <span class="c1"># Long-running test</span>
</code></pre></div>

<h2 id="test-maintenance">Test Maintenance</h2>
<h3 id="pre-existing-failures">Pre-Existing Failures</h3>
<p>The repository tracks known test failures that are not regressions:</p>
<ul>
<li><strong>Import errors</strong>: 3 known (require infrastructure changes)</li>
<li><strong>Backend compatibility</strong>: Some tests may fail with specific backends</li>
<li><strong>Platform-specific</strong>: Windows vs Unix path handling</li>
</ul>
<p>These are documented and should not block PR approval unless your changes introduce new failures.</p>
<h3 id="continuous-integration">Continuous Integration</h3>
<p>All PRs must:</p>
<ol>
<li>Pass the default test suite (<code>pytest -m "not slow"</code>)</li>
<li>Maintain or improve coverage</li>
<li>Not introduce new failures (beyond pre-existing)</li>
<li>Pass all structural fidelity tests</li>
</ol>
<h3 id="test-optimization">Test Optimization</h3>
<p>When optimizing tests:</p>
<ol>
<li>Consolidate redundant tests across directories</li>
<li>Use shared fixtures to reduce duplication</li>
<li>Parametrize instead of copying test functions</li>
<li>Profile slow tests and optimize data generation</li>
</ol>
<h2 id="debugging-tests">Debugging Tests</h2>
<h3 id="verbose-output">Verbose Output</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Show print statements and detailed assertions</span>
pytest<span class="w"> </span>-v<span class="w"> </span>-s<span class="w"> </span>tests/unit/test_operators.py

<span class="c1"># Show local variables on failure</span>
pytest<span class="w"> </span>--showlocals
</code></pre></div>

<h3 id="run-single-test">Run Single Test</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run specific test function</span>
pytest<span class="w"> </span>tests/unit/test_cache.py::test_shelve_layer_stores_data

<span class="c1"># Run test by keyword match</span>
pytest<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;coherence&quot;</span><span class="w"> </span>tests/
</code></pre></div>

<h3 id="debug-with-pdb">Debug with PDB</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Drop into debugger on failure</span>
pytest<span class="w"> </span>--pdb

<span class="c1"># Drop into debugger at test start</span>
pytest<span class="w"> </span>--trace
</code></pre></div>

<h3 id="capture-warnings">Capture Warnings</h3>
<div class="codehilite"><pre><span></span><code><span class="c1"># Show warnings</span>
pytest<span class="w"> </span>-W<span class="w"> </span>default

<span class="c1"># Treat warnings as errors</span>
pytest<span class="w"> </span>-W<span class="w"> </span>error
</code></pre></div>

<h2 id="resources">Resources</h2>
<ul>
<li><strong>ARCHITECTURE.md</strong>: TNFR invariants and canonical constraints</li>
<li><strong>SECURITY.md</strong>: Security testing guidelines</li>
<li><strong>CONTRIBUTING.md</strong>: General contribution workflow</li>
<li><strong>tests/README.md</strong>: Detailed test suite organization</li>
<li><strong>pyproject.toml</strong>: Test configuration and markers</li>
</ul>
<hr>
<p><strong>Last Updated</strong>: November 2025<br>
<strong>Version</strong>: 0.0.1</p>
    </main>
    <footer>
            <span>
                &copy; 2025
                TNFR Python Engine — Licensed under MIT.
            </span>
            <span>
                Feedback?
                <a
                    href="https://github.com/fermga/TNFR-Python-Engine"
                    target="_blank"
                    rel="noopener"
                >
                    Open an issue
                </a>.
            </span>
    </footer>
  </div>
</body>
</html>
